<section id="chat">
    <graffiti-discover 
        v-if="this.channel"
        v-slot="{ objects: invitations, isInitialPolling }" 
        :channels="[$graffitiSession.value.actor]"
        :schema="chatSchema">
        <section class="chatWindow" v-for="invite of invitations">
            <h2>
                {{invite.value.title}}
                <span v-if="invite.actor === $graffitiSession.value.actor" class="toBeRevised">
                    <button class="imgIcon icon" @click="renameChat(invite)">‚úèÔ∏è</button>
                    <button class="imgIcon icon" @click="deleteChat(invite)">üóëÔ∏è</button>
                    <!-- <button class="imgIcon icon" @click="removeMember(invite, $graffitiSession.value.actor, invite.actor == $graffitiSession.value.actor)">üö™‚û°Ô∏è</button> -->
                    <button @click="addMembers(invite)">Add Members</button>
                </span>
            </h2>

            <!-- <form @submit.prevent="addMembers(this.channel, newMembers)">
                <fieldset :disabled="adding">
                    <input type="text" v-model="newMembers" placeholder='chat members (separate members using ", ")'
                        ref="newChatMembersInput" />
                    <input type="submit" :value="adding? 'adding members...' : 'add members'" />
                </fieldset>
            </form> -->
        </section>
    </graffiti-discover>

    <h2 v-else>no chat selected</h2>

    

    <graffiti-discover v-slot="{ objects: messageObjects, isInitialPolling }" :channels="[this.channel]" :schema="{
                properties: {
                    value: {
                        required: ['content', 'published'],
                        properties: {
                            content: { type: 'string' },
                            published: { type: 'number' }
                        }
                    }
                }
            }">

        <div>
            <!-- FIX CSS LATER -->
        </div>

        <ul>
            <li v-if="isInitialPolling">Loading...</li>
            <li v-for="object of messageObjects.sort((a, b) => a.value.published - b.value.published)"
                :key="object.url">
                <section>
                    <strong>
                        {{ object.actor }}<span v-if="object.actor===$graffitiSession.value.actor">
                            (you)</span></strong>: {{ object.value.content }}
                </section>

                <section v-if="object.actor == $graffitiSession.value.actor">
                    <span class="icon" @click="revealInput($event)">
                        ‚úèÔ∏è
                    </span>

                    <span class="icon" @click="deleteMessage(object)">
                        üóëÔ∏è
                    </span>
                </section>
                <section v-else></section>

                <form class="hiddenUnlessReveal" @submit.prevent="editMessage($event, object)">
                    <input type="text" placeholder="revise above message" v-model="revisedMessage">
                    <input type="submit" value="Save" />
                </form>
            </li>
        </ul>
    </graffiti-discover>

    <section id="sendbar" v-if="this.channel">
        <!-- TODO: add in scheduler + activity functionality -->
        <section>
            <router-link :to="`/scheduler`"><button class="imgIcon"><img src="./Icons/Scheduler Icon.svg"></button></router-link>
            <!-- <button class="imgIcon"><img src="./Icons/Activity Suggester Icon.svg"></button> -->
        </section>
        <form @submit.prevent="sendMessage()">
            <fieldset :disabled="sending">
                <input type="text" v-model="message" placeholder="message" ref="messageInput" />
                <input type="submit" :value="sending? 'sending...' : 'send'" />
            </fieldset>
        </form>
    </section>
</section>